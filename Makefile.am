include $(top_srcdir)/common.mk

ACLOCAL_AMFLAGS = -I m4

EXTRA_DIST =    ${top_srcdir}/README.rst \
		${top_srcdir}/LICENSE \
		${top_srcdir}/common.mk \
		${top_srcdir}/src/header.h \
		${top_srcdir}/tests/data/common/nvdcve-2.0-2002.meta \
		${top_srcdir}/tests/data/common/nvdcve-2.0-2002.meta.xtests \
		${top_srcdir}/tests/data/common/Test.gz \
		${top_srcdir}/tests/data/datasources/nvd/nvdcve-2.0-2016.meta \
		${top_srcdir}/tests/data/datasources/nvd/nvdcve-2.0-2016.xml.gz \
NULL =
CLEANFILES =
AM_CFLAGS =
SUBDIRS = src

if COVERAGE
coverage:
	mkdir -p coverage
	lcov --compat-libtool --directory . --capture --output-file coverage/report
	lcov --remove coverage/report 'tests/*' '/usr/*' --output-file coverage/report
	genhtml -o coverage/ coverage/report
endif

distclean-local:
	rm -v ${top_builddir}/tests/data/common/*.gunzip


if ENABLE_UNIT_TESTS

TESTS = \
	check_common \
	check_nvd

check_PROGRAMS = $(TESTS)

# Core tests
check_common_SOURCES = \
	tests/check-common.c

check_common_CFLAGS = \
	$(CHECK_CFLAGS) \
	$(AM_CFLAGS)

check_common_LDADD = \
	$(CHECK_LIBS) \
	src/common/libcvecommon.la

# NVD test
check_nvd_SOURCES = \
	tests/check-nvd.c

check_nvd_CFLAGS = \
	$(CHECK_CFLAGS) \
	$(AM_CFLAGS) \
	$(DATASOURCE_NVD_CFLAGS) \
	-I src/datasource/nvd

check_nvd_LDADD = \
	$(CHECK_LIBS) \
	src/common/libcvecommon.la \
	src/datasource/libcvedatasource.la

@VALGRIND_CHECK_RULES@

endif
